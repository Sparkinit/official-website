---
import { getImage } from "astro:assets";
import Layout from "@/layouts/Layout.astro";
import Brand from "@/components/ui/Brand";
import { user, session } from "@/stores";
import Wordmark from "@/components/ui/Wordmark";
import Countdown from "@/components/Countdown";
import Form from "@/components/Form";
import background from "@/assets/background.png";

const image = await getImage({
  src: background,
  format: "webp",
});

user.set(Astro.locals.user);
session.set(Astro.locals.session);

const $user = user.get();

const now = new Date();
const activationDate = $user?.activationDate;

const isActivationDateReached = activationDate && now >= activationDate;
// const isAiApproved = $user?.aiApproved === true;
const isFormSubmitted = $user?.formSubmitted === true;
---

<Layout>
  <div
    class="absolute top-1/2 left-1/2 z-10 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all ease-in-out sm:h-3/4 sm:w-2/3 md:h-2/3 md:w-1/3"
  >
    {
      $user?.email !== null &&
        (!isActivationDateReached ? (
          <Countdown
            now={now}
            activationDate={activationDate}
            imageSrc={image.src}
            client:load
          />
        ) : // ) : !isAiApproved ? (
        //   <div>todo: chatbot</div>
        !isFormSubmitted ? (
          <Form />
        ) : (
          <div>todo: success</div>
        ))
    }
  </div>

  <div class="relative h-screen w-full">
    <div class="absolute top-0 right-0 left-0 z-20">
      <div
        class="flex flex-col px-3 pt-4 transition-all duration-300 ease-in-out sm:px-6 sm:pt-6 md:px-8 md:pt-8"
      >
        <Wordmark client:load />
        <div class="flex flex-row gap-4 text-xl">燎原计划</div>
      </div>
    </div>
    <div class="absolute right-0 bottom-0 left-0">
      <div
        class="flex w-full flex-row items-center justify-between px-3 pb-4 transition-all duration-300 ease-in-out sm:px-6 sm:pb-6 md:px-8 md:pb-6"
      >
        <div class="w-42">
          <Brand client:load />
        </div>
        <span class="text-xl font-light uppercase"
          >A single spark can start a prairie fire</span
        >
      </div>
    </div>
  </div>
</Layout>
