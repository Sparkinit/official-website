---
import Layout from "@/layouts/Layout.astro";
import Brand from "@/components/ui/Brand";
import Countdown from "@/components/Countdown";
import { user, session } from "@/stores"

const $user = user.get();

const now = new Date();
const activationDate = $user?.activationDate;

user.set(Astro.locals.user);
session.set(Astro.locals.session);

const isActivationDateReached = activationDate && now >= activationDate;
const isAiApproved = $user?.aiApproved === true;
const isFormSubmitted = $user?.formSubmitted === true;
---

<Layout>
	<div class="max-w-screen-sm mx-auto px-md md:px-lg w-full h-screen">
      <div class="flex flex-col gap-12 items-center justify-center h-full">
        <Brand client:load />
        {
          $user?.email !== null
            && (
              !isActivationDateReached ? (
                <Countdown now={now} activationDate={activationDate} client:load />
              ): !isAiApproved ? (
                <div>todo: chatbot</div>
              ): !isFormSubmitted ? (
                <div>todo: form</div>
              ): (
                <div>todo: success</div>
              )
          )
        }
      </div>
  </div>
</Layout>
